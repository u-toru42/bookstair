<% content_for(:title, @book.title) %>

<div class="bg-slate-50 flex justify-center border-2 border-gray-200 text-sm min-h-screen">
  <section class="max-w-5xl p-2 rounded">
    <div>
      <% if @bookmark.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@bookmark.errors.count, "error") %> prohibited this bookmark from being saved:</h2>
          <ul>
            <% @bookmark.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 sm:items-center" data-title="ようこそBOOKSTAIRへ！" data-intro="投稿の方法を説明します！">
      <div class="flex justify-center item-center card mr-2 2xl:mr-2 xl:mr-2 lg:mr-2 md:mr-2 sm:mr-0 mb-1">
        <%= image_tag @book.large_image_url, style: "width: 200px; height: 250px; object-fit: contain;", class:"m-1" %>
      </div>

      <blockquote class="sm:col-span-2 bg-slate-50 rounded p-3 card">
        <h1 class="text-lg font-semibold sm:text-md">
          <%= set_rakuten_book_params(@book.title) %>
        </h1>

        <p class="text-base mb-1">著者: <%= set_rakuten_book_params(@book.author) %></p>

        <p class="text-base font-semibold"><%= number_to_currency(@book.item_price, format: "%u%n", unit: "￥") %></p>

        <div class="mt-2">
          <div class="prose max-w-none">
            <p>
              <%= simple_format(@book.item_caption) %>
            </p>
          </div>
        </div>
        <div class="shadow--md">
          <div class="flex justify-end gap-2 mt-2">
            <p class="flex jusity-center items-center">
              <%= render 'shared/intro_button' %>
            </p>
            <%= link_to @book.item_url, target: '_blank', class: "flex flex-col items-center" do %>
              <%= image_tag "rakuten_shop.png", class: "w-8 h-8 object-cover", title: "楽天で購入" %>
              <span class="text-sm mt-1">楽天リンク</span>
            <% end %>
            <div class="flex justify-end">
              <% if user_signed_in? %>
                <% if @book.favorited_by?(current_user) %>
                  <%= button_to book_favorites_path(@book), method: :delete, data: { turbo_method: :delete }, class: "flex flex-col items-center" do %>
                    <svg class="h-8 w-8 mr-1" color="#f87171" data-darkreader-inline-stroke="" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"></path>
                    </svg>
                    <span class="text-sm mt-1 mr-1">いいね解除</span>
                  <% end %>

                <% else %>
                  <%= link_to book_favorites_path(@book), method: :post, remote: true, data: { turbo_method: :post }, class: "flex flex-col items-center" do %>
                    <svg class="h-8 w-8 mr-1" data-darkreader-inline-stroke="" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"></path>
                    </svg>
                    <span class="text-sm mt-1 mr-1">いいね！</span>
                  <% end %>
                <% end %>
              <% end %>
            <%= render 'bookmarks/modal', { book: @book, bookmark: @bookmark } %>
            </div>
          </div>
      </div>

      </blockquote>
        <div class="card__body" data-title="ここが投稿エリアです！" data-intro="こちらは投稿例です！<br>投稿はこの下に更新され、チャプター順でソートされます！<br>投稿後も編集ができるので、気軽に投稿してみましょう！">
          <div class="py-1">
            <table id ="js-table-bookmark" class="table" data-controller="bookmarks">
              <%= render 'bookmarks/bookmarks', { bookmarks: @bookmarks } %>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

